import { useFrame } from "@react-three/fiber";
import {
  CapsuleCollider,
  RapierRigidBody,
  RigidBody,
} from "@react-three/rapier";
import { FC, useEffect, useRef } from "react";
import { Group, Vector3 } from "three";
import getPatrolImpulse from "./helper/getPatrolImpulse";
import { EntitiesNames } from "../../../lib/object3DHelper";
import Farmer3DModel from "../Farmer/Farmer3DModel";

export const AbstractPersonel: FC<{
  initialVertext: Vector3;
  currentVertexPosition: Vector3;
  nextVertexPosition: Vector3;
}> = ({ initialVertext, currentVertexPosition, nextVertexPosition }) => {

    const NPCModelByEntity =
  const farmerBody = useRef<RapierRigidBody>(null);
  const farmerGroup = useRef<Group>(null);
  const farmer3DModelGroup = useRef<Group>(null);

  useEffect(() => {
    if (!farmer3DModelGroup?.current) return;
    farmer3DModelGroup.current.lookAt(nextVertexPosition);
    farmer3DModelGroup.current.rotation.x = 0;
    farmer3DModelGroup.current.rotation.z = 0;
  }, [nextVertexPosition.x, nextVertexPosition.z]);

  useFrame(() => {
    if (!farmerBody?.current) return;

    farmerBody.current.setLinvel(
      getPatrolImpulse(
        currentVertexPosition,
        nextVertexPosition
      ).multiplyScalar(2),
      false
    );
  });

  return (
    <group ref={farmerGroup}>
      <RigidBody
        name={EntitiesNames.FARMER}
        ref={farmerBody}
        lockRotations={true}
        friction={4}
        restitution={0}
        density={62}
        colliders={false}
        position={initialVertext}
      >
        <CapsuleCollider args={[0.2, 0.2]} position={[0, 0.4, 0]} />
        <group ref={farmer3DModelGroup}>
          <Farmer3DModel scale={0.6} />
        </group>
      </RigidBody>
    </group>
  );
};

export default AbstractPersonel;
